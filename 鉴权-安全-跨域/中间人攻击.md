## 中间人攻击

### 攻击过程

1. 客户端发送请求到服务端，请求被中间人截获；
2. 服务器向客户端发送公钥；
3. 中间人截获公钥，保留在自己手上。然后自己生成一个【伪造的】公钥，发给客户端；
4. 客户端收到伪造的公钥后，生成加密hash值发给服务器；
5. 中间人获得加密hash值，用自己的私钥解密获得真秘钥。同时生成假的加密hash值，发给服务器；
6.  服务器用私钥解密获得假密钥。然后加密数据传输给客户端。

### 防范  -- 数字证书

数字签名和数字证书总是成对出现，二者不可分离。**数字签名主要用来验证数据完整性和认证数据来源，而数字证书主要用来安全地发放公钥。** 数字证书主要包含三个部分：

- 申请者【如B站】的信息；
- 申请者公钥；
- CA `对该证书实体信息的签名`。

**[数字证书的模型主要分为两个步骤：](https://juejin.cn/post/6995549209348816909)** 【和验证使用证书内公钥验证数据流程一样，递归起来了】

- **1、颁发证书：**
  - 1.1 申请者将签名算法、公钥、有效时间等信息发送给 CA 机构；
  - 1.2 CA 机构验证申请者身份后，将申请者发送的信息打成一个实体，并计算摘要；
  - 1.3 CA 机构使用自己的私钥对摘要进行加密，生成证书签名（Certificate Signature）；
  - 1.4 CA 机构将证书签名添加在数字证书上，构成完整的数字生出。
- **2、验证证书**
  - 2.1 验证方使用相同的摘要算法计算证书实体的摘要；
  - 2.2 使用 CA 机构的公钥（浏览器和操作系统中集成了 CA 的公钥信息）解密证书签名；
  - 2.3 对比解密后的数据与计算的摘要是否一致，如果一致则是可信任的证书。

![image-20220601170512365](D:\Sync\typora图片\image-20220601170512365.png)



**证书链 - 证书的递归**

![image-20220624161303357](D:\Sync\typora图片\image-20220624161303357.png)

